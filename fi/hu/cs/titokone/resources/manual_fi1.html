<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"
      "http://www.w3.org/TR/REC-html40/loose.dtd">
<html lang="en">
<head>
  <title>Titokoneen käyttöohje</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <style type="text/css">
   .virhekuvaus { font-weight: bold; }
   .virhetoipuminen { padding-bottom: 1em; }
  </style>
</head>
<body>
<h1>Titokoneen käyttöohje</h1>

<!-- OLLI: Laitoin yläotsikoille (h2) valmiiksi a name -ankkurit,
     jotta #-linkit toimivat. Lisäile ankkureita ja tunnuksia
     loogiseksi katsomallasi nimeämisperusteella sitä mukaa kun tulee
     tarpeen viitata aiempiin/tuleviin aliotsikoihin (kuten
     esimerkiksi esimerkkivirhetilanteessa, jonka kirjailin
     loppupäähän). Tämän kommentin voi poistaa lukemisen jälkeen. -->

<h2>Sisällysluettelo</h2>

<ol>
  <li><a href="#yleiskuva">Yleiskuva</a></li>
  <li><a href="#toiminnot">Järjestelmän toiminnot</a></li>
  <li><a href="#konekieli">TTK-91-konekieli</a></li>
  <li><a href="#laajentaminen">Järjestelmän hienosäätö ja laajentaminen</a></li>
  <li><a href="#pulmanpoisto">Virhetilanteita</a></li>
  <!-- <li><a href="hakemisto">Asiahakemisto</a></li> --> <!-- jos jaksaa kerätä-->
</ol>

<h2><a name="yleiskuva">1. Yleiskuva</a></h2> <!-- niinku täh? mikätääon? -->

<p>
Titokone on konekielisimulaattori, jonka tarkoituksena on näyttää, kuinka symbolisen
konekielen suoritus etenee yksinkertaisella prosessorilla. 

* kun kuvaillaan koodinäkymää, siinä pitää muistaa korostaa että muisti
on yhtenäinen alue vaikka siitä onkin eristetty osa koodialueeksi. Myös
maininta siitä, että data-alueella symbolisella arvolla ei ole
merkitystä (ja että suurin osa komennoista on jonkinlaisia noppeja)
lienee hyvästä.

* näppäinshortcutit, jahka varmistuvat, mukaan kuvauksiin.
</p>

<table>
<tr>

<td>
<a href="manual_fi2.html#gui" name="gui">
<img src="screen1.jpg" title="Järjestelmän perusnäkymä" 
  alt="Järjestelmän perusnäkymä, jossa eri osiot numeroitu">
</a>
</td>

<td>
<ol>
     <li> Valikot </li>
     <br>
     <li> Lähdekoodi</li>
     <br>
     <li> Tilatiedot </li>
     <br>
     <li> Näyttö </li>
     <br>
     <li> Näppäimistösyötteet </li>
     <br>
     <li> Symbolitaulu </li>
     <br>
     <li> Rekisterit </li>
     <br>
     <li> Kommentti-ikkuna </li>
</ol>


</td>

</tr>
</table>



<!-- Kuvaillaan käyttöliittymän osat numeroittain: 1. valikot: höpöhöpö jne. -->
<!-- Kunkin selityksestä viitteitä kohtiin, joissa sitä käytetään. -->


<h2><a name="toiminnot">2. Toiminnot</a></h2> <!-- mitä tällä voi tehdä? -->



<!-- TITOKONEEN KÄYNNISTYS -->




<table cellspacing=10>
<tr>
<td>  
<img src="0.jpg" title="" 
alt="">
</td>
<td>
<h3>2.1 Titokoneen käynnistäminen</h3>
</td>
</tr>
</table>



<p> Titokone on toteutettu javalla ja se käynnistetään jar-paketista. </p>


<br>



<!-- OHJELMAN AVAAMINEN -->



<table cellspacing=10>
<tr>
  <td align=center>
  <a name="avaa">
  <img src="1.jpg" title="Avaa kuvakkeesta" 
  alt="Kuva avaa-painikkeesta">
  </a>
  </td>

<td>
  <h3>2.2 TTK-91-ohjelman avaaminen</h3> 
</td>

</tr>
</table>
  
<br>

<table cellspacing=10>
<tr>
  
<td valign=top>

<img src="Tiedostoavaa2.jpg" title="Avaa valikosta" 
alt="Kuva avaa-painikkeesta">

</td>
      
<td valign=top>
<p> 
  Uuden tiedoston avaaminen tapahtuu painamalla <a href="1.jpg">käännä-pikakuvaketta</a> tai
  valitsemalla valikosta Tiedosto -->  Avaa. Valinnan seurauksena
  avautuu <a href="#tiedosto">tiedostonäkymä</a>.

</p>
</td>

</tr>
</table>

<table cellspacing=10>
<tr>
  
<td valign=top>
<a name="tiedosto">
<img src="Tiedosto.jpg" title="Tiedostonäkymä" 
alt="Tiedostonäkymä">
</a>
</td>
<td valign=top>
<p>
Tiedostonäkymä näyttää nykyhakemiston tiedostot valitun päätteen mukaan. 
Näytettävät tiedostotyypit erotellaan päätteen mukaan: k91-pääte tarkoittaa lähdekooditiedostoa ja
b91-pääte binääritiedostoa.
</p>
<ul><li>
Avattaessa k91-päätteinen tiedosto, avautuu <a href="manual_fi1.html#gui">lähdekoodinäkymä</a> ruudulle.
Lähdekooditiedosto on <a href="#kaanna">käännettävä</a> ennen kuin se voidaan <a href="#aja">suorittaa</a>.
</li>
<br>
<li>
Avattaessa b91-päätteinen tiedosto, avautuu <a href="manual_fi3.html#gui">suoritusnäkymä</a> ruudulle.
Binääritiedostoa on valmiiksi konekielimuodossa, joten se voidaan <a href="#aja">suorittaa</a> ilman kääntämistä.
</li>
</ul>
</td>
</tr>
</table>

<br>




<!-- LÄHDEKOODIN MUOKKAUS -->




<table cellspacing=3>
<tr>
<td>  
<img src="0.jpg" title="" 
alt="">
</td>
<td>
<a name="koodinmuokkaus">
<h3> 2.3. Lähdekoodin muokkaaminen </h3>
</a>
</td>
</tr>
</table>


<p>Lähdekoodia on mahdollista muokata Titokoneessa seuraavasti: </p>
<ul>
<li> Avataan K91-päätteinen tiedosto. </li>
<li> Kaksoisklikataan lähdekoodin riviä vasemmalla hiiren napilla, kursori ilmestyy riville. </li>
<li> Kirjoitetaan riville muutokset. </li>
<li> Vahvistetaan muutokset painamalla enteriä. </li>
<li> Tehdyt muutokset tallettuvat alkuperäiseen tiedostoon. </li>
</ul>

 


  <!-- Voi olla k91 tai b91, viittaa vastaaviin 2.x-lukuihin -->

<br>




<!-- OHJELMAN KÄÄNTÄMINEN-->




    
  <table cellspacing=10>
  <tr>
  
  <td>
  <img src="2.jpg" title="Käännä" 
  alt="Kuva käännä-painikkeesta">
  </td>
  
  <td>
  <a name="kaanna">
  <h3>2.4 TTK-91-ohjelman kääntäminen</h3> <!-- Ja mahd. tekstin muokkaus -->
  </a>
  </td>
  
  </tr>
  </table>
      
  <table cellspacing=10>
  <tr>

  <td valign=top>
  <img src="Tiedostokaanna.jpg" title="Kääntäminen valikosta" 
  alt="Kuva käännä-painikkeesta">
  </td>
  
  <td valign=top>
  <p>
  Titokoneen käännös on kaksivaiheinen: ensin tehdään syntaksitarkistus ja luodaan symbolitaulu. Toisella kierroksella muodostetaan objektikoodi.
  Kääntäminen aloitetaan painamalla <a href="2.jpg">käännä-pikakuvaketta</a> tai valitsemalla valikosta Tiedosto --> Käännä.
  Kääntäminen toteutetaan <a href="#kaannosasetukset">käännösasetusten</a> mukaisesti.
  joko pysähdellen tai kerralla loppuun asti kääntäen. 
  </p>
  </td>
  </tr>
  </table>
  
  <br>
  <a name="kaantajantoiminnot">
  <b>
  Toiminnot kääntämisen aikana
  </b>
  </a>
  
  <table cellspacing=10>
  <tr>
   
  <td>
  <img src="4.jpg" title="Kelaa" 
  alt="Kuva kelaa-painikkeesta">
  </td>
  <td><p> Kääntämistä voi suorittaa askel kerrallaan, edeten seuraavaan <a href=#kaannostapahtumat> tapahtumaan </a> asti. </p>
  </td>
  </tr>
  
  <tr>
  <td><img src="5.jpg" title="FF" 
  alt="Kuva FF-painikkeesta">
  </td>
  
  <td><p> Halutessaan käyttäjä voi suorittaa käännöksen kerralla loppuun.</p>
  </td>
  </tr>
  
  <tr>
  <td><img src="6.jpg" title="STOP" 
  alt="Kuva stop-painikkeesta">
  </td>
  <td>
  <p> Käännös voidaan pysäyttää painamalla stop-nappia.
  </td>
  </tr>
  </table>
  <br>
  <a name="kaannostapahtumat">
  <b> Käännöksen tapahtumatyypit </b>
  </a>
  <p> Tapahtumatyypeillä tarkoitetaan kääntäjän reagointia lähdekoodin sisältöön. Riviä kommentoidaan tai riville pysähdytään <a href=#kaannosasetukset>asetusten</a> mukaisesti.</p>
  <p> Ensimmäinen kierros:</p>
  <ul>
  <li> Ei tapahtumaa: jos rivi alkaa kommenttimerkillä (;), on tyhjä tai sisältää käskyn NOP </li>
  <li> Muuttujan määrittely: Jos riviltä löytyy uusi muuttuja, se lisätään symbolitauluun. </li>
  <li> Muuttujan käyttäminen: Jos rivin komennossa käytetään muuttujaa, muuttuja lisätään symbolitauluun jos se ei siellä vielä ole. </li>
  <li> Muistiviitteen löytyminen: Jos rivin alusta löytyy muistiviite,viite ja rivin numero lisätään symbolitauluun </li>
  <li> Käännöksen virhetilanne: käännös keskeytetään, virheestä ilmoitetaan käyttäjälle ja jatka-painikkeella palaudutaan lähdekoodinäkymään. </li>
  <li> Ensimmäisen käännösvaiheen valmistuminen: onnistuneen ensimmäisen kierroksen jälkeen <a href="manual_fi2.html#gui">objektikoodinäkymä</a> tuodaan esiin ja toinen kierros voi alkaa. </li> 
  </ul>
  <p> Toinen kierros: </p>
  <ul> 
  <li> Objektikoodin luonti: koodiriville tuodaan käskyn konekieliesitys ja käsky näytetään alapalkin tilatiedoissa. </li>
  <li> Toisen käännösvaiheen valmistuminen: ohjelma <a href=#lataaminen>ladataan</a> muistiin.</li>
  </ul>
  <br>
  
  
  
  <!-- KÄÄNNÖSASETUKSET-->
  
  
  
  <table cellspacing=10>
  <tr>
  <td>  
  <img src="0.jpg" title="" 
  alt="">
  </td>
  <td>
  <a name="kaannosasetukset">
  <h3>2.5 Käännösasetukset </h3>
  </a>
  </td>
  </tr>
  </table>
  
  
  
  
  <table cellspacing=10>
  <tr>
  <td>
  <img src="Tiedostomuokkaakaannos.jpg" title="Käännösasetukset valikosta" 
  alt="Käännösasetukset valikosta">
  </td>
  <td valign=top>
  <p>
  Käännöksen aikaisia asetuksia voi muuttaa valitsemalla valikosta Asetukset --> Muokkaa käännösasetuksia.
  </p>
  </td>
  
  </tr>
  <tr>
  <td>
  
  <img src="Kaannosasetukset.jpg" title="Käännösasetukset" 
  alt="Käännösasetukset">
  
  </td>
  <td valign=top> 
  <p>
  Käännösasetuksilla voidaan vaikuttaa käännöksen etenemistapaan ja kommentointiin.
  </p>
  <ul>
  <li>Jos 'Pysäytä kääntäminen kommentin ilmestyessä' on valittuna, käännös etenee askelittain. Käännös jää odottamaan käyttäjältä seuraavaa <a
  href=#kaantajantoiminnot>toimintoa</a>.
  </li>
  <li>Jos 'Näytä lisäkommentteja kääntämisen kulusta' on valittuna, rivin kääntämisestä ilmestyy lisäkommentteja kommentti-ikkunaan.
  
  </ul>
    
  </td>
  
  </tr>
  </table>
  
  <br>
   
  
  
  
  
  <!-- OHJELMAN LATAAMINEN-->
  
  
  
  
  <table cellspacing=10>
  <tr>
  <td>  
  <img src="0.jpg" title="" 
  alt="">
  </td>
  <td>
  <h3><a name="lataaminen">2.6 TTK-91-ohjelman lataaminen</a></h3>
  </td>
  </tr>
  </table>
  
  
  <p> Ohjelman lataaminen tapahtuu automaattisesti </p>
  <ul>
  <li>K91-tiedoston <a href=#kaanna>kääntämisen</a> valmistuessa.</li>
  <li>B91-tiedoston <a href=#avaa>avaamisen</a> yhteydessä </li>
  </ul>
  <br>
  
  <!-- BINÄÄRIN TALLETTAMINEN-->
  
   <table cellspacing=10>
  <tr>
  <td>  
  <img src="0.jpg" title="" 
  alt="">
  </td>
  <td>
  <h3>2.7 TTK-91-ohjelman binäärin tallentaminen</h3>
  </td>
  </tr>
  </table>
    <!-- Tapahtuu jälleen "automaattisesti". Tallentuu sinne missä 
         lähdekoodikin, päätteellä .b91. -->
  <br>
  
  
   <!-- SUORITUS-->
  
  
    
  <table cellspacing=10>
  <tr>
  
  <td>  
  <a name="aja">
  <img src="3.jpg" title="Suorita" 
  alt="Kuva suorita-painikkeesta">
  </td>
  </a>    
  
  <td>
  <h3> 2.8 TTK-91-ohjelman suoritus</h3> <!-- Ja uudelleensuoritus -->
  </td>
  
  </tr>
  </table>
     
  
  <table cellspacing=10>
  <tr>
  <td>  
  <img src="Tiedostoaja.jpg" title="Aja valikosta" 
  alt="Ohjelman suoritus valikosta">
  </td>
  <td valign=top> K91-tiedoston käännöksen tai b91-tiedoston avaamisen seurauksena ohjelma ladataan muistiin ja on valmis suoritettavaksi.<a href=manual_fi3.html#gui>
  Suoritusnäkymässä</a> koodi-ikkuna on jaettu kahteen osaan, koodi- ja data-alueeseen. On kuitenkin syytä huomioida, että titokoneen muisti on todellisuudessa yhtenäinen alue; muistialueen jako kahteen osaan on toteutettu käytettävyyssyistä. Suoritus aloitetaan painamalla  <a href="3.jpg">suorita-pikakuvaketta</a>  tai valitsemalla valikosta Tiedosto --> Aja. Suoritus toteutetaan <a href=#suoritusasetukset>suoritusasetusten</a> mukaisesti joko pysähdellen tai kerralla loppuun asti suorittaen. </td>
  
  </tr>
  </table>
  <br>
  
  <b> Toiminnot suorituksen aikana </b>
  
  <table cellspacing=10>
  <tr>
   
  <td>
  <img src="4.jpg" title="Kelaa" 
  alt="Kuva kelaa-painikkeesta">
  </td>
  <td><p> Ohjelman ajaminen voidaan tehdä rivi kerrallaan.</p>
  </td>
  </tr>
  
  <tr>
  <td><img src="5.jpg" title="FF" 
  alt="Kuva FF-painikkeesta">
  </td>
  
  <td><p> Halutessaan käyttäjä voi suorittaa ohjelman yhdellä napin painalluksella.</p>
  </td>
  </tr>
  
  <tr>
  <td><img src="6.jpg" title="STOP" 
  alt="Kuva stop-painikkeesta">
  </td>
  <td>
  <p> Suoritus voidaan pysäyttää painamalla stop-nappia.
  </td>
  </tr>
  </table>
  <br>
  
  
  
  
  
  <!-- SUORITUSASETUSTEN MUUTTAMINEN -->
  
  
  
  
  <table cellspacing=10>
  <tr>
  
  <td>  
  <a name="suoritusasetukset">
  <img src="0.jpg" title="" 
  alt="">
  </a>
  </td>
  <td>
  <h3>2.9 Suoritusasetukset </h3>
  </td>
  </tr>
  </table>
  
  
  <table cellspacing=10>
  <tr>
  <td>
  <img src="Suoritusvalikko.jpg" title="Valikko suorita" 
  alt="Suoritusasetukset valikosta">
  </td>
  <td valign=top>
  <p> Suoritusasetuksia pääsee vaihtamaan valitsemalla valikosta Asetukset --> Muuta suoritusasetuksia </p>
  
  </td>
  </tr>
  <tr>  
  <td rowspan=3>
  <img src="Suoritusasetukset.jpg" title="Suoritusasetukset" 
  alt="Suoritusasetukset">
  </td>
  <td>
  <p> Suoritusasetukset ovat melko pitkälti vastaavat <a href=#kaannosasetukset>käännösasetusten</a> kanssa; lisätoimintona on animointi.
  <ul>
  <li> ohjelmakoodia voidaan suorittaa rivi kerrallaan </li>
  <li> lisäkommentteja voidaan näyttää <a href="manual_fi3.html#gui">kommentti-ikkunassa(8)</a></li>
  <li> animointi-ikkuna voidaan kytkeä päälle tai pois </li>
  </ul>
  </td>
  </tr>
  </table>
  
  <p> Suoritusasetuksia on mahdollista muuttaa myös suoraan pikakuvakkeista:</p>
  <table cellspacing=10>
  <tr>
  <td>
  <img src="7.jpg" title="Riveittäin suoritus" 
  alt="Riveittäin suoritus">
  </td>
  <td>
  <p>   Riveittäin suorituksen kytkeminen päälle tai pois. </p>
  </td> 
  </tr>
  <tr>
  <td>
  <img src="8.jpg" title="Suorituksen kommentointi" 
  alt="Suorituksen kommentointi">
  </td>
  <td>
  <p> Suorituksen lisäkommentoinnin kytkeminen päälle tai pois. </p>
  </td>
  
  </tr>
  <tr>
  <td>
  <img src="9.jpg" title="Animointi" 
  alt="Animointi">
  </td>
  <td>
  <p> Animointi-ikkunan näyttämisen kytkeminen päälle tai pois. </p>
  </td>
  </tr>
  </table>
  <!---
  <table>
  <tr>
  <td>
  <img src="Animointi.jpg" title="Kuva animaattorista" 
  alt="Kuva animaattorista">
  </td>
  </tr>
  
  </table> -->
  
  
  
  <!-- MUISTIN TYHJENTÄMINEN -->
  
  <table cellspacing=10>
  <tr>
  
  <td>  
  <img src="0.jpg" title="" 
  alt="">
  </td>
  <td>
  <h3>2.10 Muistin tyhjentäminen</h3> 
  </td>
  </tr>
  </table>
   
  <!-- Viimeistään täällä maininta muistin pysymisestä samana ellei sitä
       nollata. -->
  <table>
  <tr>
  
  <td>
  <img src="Tyhjennamuisti.jpg" title="Muistin tyhjentäminen" 
  alt="Muistin tyhjentäminen">
  </td>
  <td valign=top>
  <p> Titokoneen muistin voi tyhjentää valikosta valitsemalla <b>Tiedosto --> Tyhjennä muisti</b>. Muistin tyhjentämisen lisäksi toiminnolla voidaan tyhjentää lähdekoodinäkymä. 
  Jos toimintoa käytetään käännös- tai ajovaiheessa, kyseinen toiminto keskeytyy ja ruudulle palautetaan <a href=#gui>alkunäkymä</a>, jossa rekisterit, symbolitaulu ja
  koodinäkymä on tyhjennetty. </p> 
  
  </td>
  
  </tr>
  </table>
  <br>
       
  <td>  
  <img src="0.jpg" title="" 
  alt="">
  </td>
  <td> 
  <h3>2.11 Muistin koon vaihtaminen</h3>
  </td>
  </tr>
  </table>
  
  <table>
  <tr>
  
  <td>
  <img src="Muisti.jpg" title="Muistin koon muuttaminen" 
  alt="Muistin koon vaihtaminen valikosta">
  </td>
  <td valign=top>
  <p> Titokoneen muistin kokoa on mahdollista muuttaa valitsemalla valikosta <b>Asetukset --> Aseta muistin koko</b>.
  Muistin kokovaihtoehtoja on kahdeksan erilaista 512 rivistä 65536 riviin asti. Kun uusi muistin koko asetetaan, koodinäkymä tyhjennetään
  ja näkyville palautetaan <a href="manual_fi.html#gui">alkunäkymä</a>.</p>
  </p>
  </td>
  </tr>
  </table>
  
  
  
  <td>  
  <a name="kielenvaihto">
  <img src="0.jpg" title="" 
  alt="">
  </a>
  </td>
  <td>
  <h3>2.12 Käyttöliittymän kielen vaihtaminen</h3>
  </td>
  </tr>
  </table>
  
  <table>
  <tr>
  
  <td>
  <img src="Asetakieli.jpg" title="Kieliasetusten vaihtaminen" 
  alt="Kieliasetukset">
  </td>
  <td>
  <p>
  Titokoneen käyttöliittymässä on mahdollista vaihtaa kieliasetuksia. Kieli valitaan valikosta <b>Asetukset --> Aseta kieli</b>. Oletuskielinä on suomi ja englanti.
  Kielen voi vaihtaa suoraan lennosta, lähes riippumatta käyttöliittymän muista toiminnoista. Myös <a href=#kielenlisays>uuden kielen lisääminen</a> on mahdollista
  Jos käyttäjä on määritellyt oman kielitiedoston, se haetaan valitsemalla valikosta <b> Asetukset --> Aseta kieli --> Valitse tiedostosta...</b>. Tämän jälkeen
  käyttäjän on haettava luotu kielitiedosto ja avattava se. Jos kielitiedosto on oikeaa muotoa, kieli vaihtuu välittömästi. Jos tietyn tekstin käännösvastine puuttuu
  kielitiedostosta, käytetään käyttöliittymässä oletuskieltä, englantia, kyseisen sanan kohdalla.
  
  </p>
  </td>
  </tr>
  </table>

 <!-- Jne, sopivassa järjestyksessä. -->

<h2><a name="konekieli">3. TTK-91-konekieli</a></h2>
<!-- Tässä voi miettiä, haluaako toistaa tekstitiedoston speksin vähän 
     siistimmässä formaatissa vaiko vain. Mietin, nyt päädyin tähän...
-->

<pre>
======================================================================
                     YHTEENVETO TTK-91-KÄSKYISTÄ
======================================================================

+--------------------------------------------------------------------+
|    Käskykoodi    ¦  Rj ¦ M ¦  Ri ¦      osoiteosa ADDR             |
|    8 bittiä      ¦  3  ¦ 2 ¦  3  ¦         16 bittiä               |
+--------------------------------------------------------------------+
31               24 23           16 15                               0

Symbolisessa konekielessä käskyt esitetään muodossa

VIITE  OPER Rj,M ADDR(Ri)

missä  OPER    käskyn symbolinen nimi
       Rj      ensimmäinen operandi (rekisteri R0..R7)
       M       osoitusmoodi:
               =   välitön operandi
                   suora osoitus (tyhjä, ei siis merkitä)
               @   epäsuora osoitus
       ADDR    osoiteosa (muistiosoite tai vakio)
       Ri      mahdollinen indeksirekisteri (rekisteri R0..R7)

Jos jollakin käskyn osalla ei ole merkitystä, sen voi jättää merkitse-
mättä. Käskyn eteen voi laittaa viitteeksi symbolisen osoitteen, jonka
tulee sisältää vähintään yksi muu kuin numeromerkki. Kelvollisia merkkejä
A-Ö, 0-9 ja _. Vain 8 ensimmäistä merkkiä on merkitseviä.

Lähes kaikille käskyille on käytettävissä seuraavat muodot:

   OPER Rj,ADDR        suora muistiosoitus
   OPER Rj,=ADDR       välitön operandi 
   OPER Rj,@ADDR       epäsuora muistiosoitus
   OPER Rj,ADDR(Ri)    indeksoitu osoitus
   OPER Rj,=ADDR(Ri)   indeksoitu välitön osoitus
   OPER Rj,@ADDR(Ri)   indeksoitu epäsuora muistiosoitus
   OPER Rj,Ri          suora rekisteriosoitus

Poikkeuksia ovat:

    STORE           jälkimmäinen operandi on aina kohdeosoite,
                    ei voi olla rekisteri, tai vakio.
    POP             Jälkimmäisen operandin tulee aina olla rekisteri
    HYPPYKÄSKYT     jälkimmäinen operandi on aina kohdeosoite,
                    ei voi olla vakio
                    tilarekisteriä tutkivissa käskyissä on ensimmäinen
                    operandi merkityksetön
    NOP             operandeilla ei merkitystä

======================================================================
                 TTK-91 symbolisen konekielen käskyt
======================================================================

Tiedonsiirtokäskyt:

LOAD   vie jälkimmäisen operandin arvon rekisterin Rj arvoksi.
STORE  talleta rekisterissä Rj oleva  kokonaisluku jälkimmäisen operan-
       din arvoksi.
IN     lukee jälkimmäisenä operandina kerrotulta laitteelta kokonaislu-
       vun rekisteriin Rj (näppäimistöltä esim IN R1,=KBD)
OUT    tulostaa rekisterissä Rj olevan kokonaisluvun jälkimmäisenä
       operandina kerrotulle laitteelle (näytölle esim. OUT R1,=CRT)

Aritmeettiset ja loogiset käskyt:

ADD    (add) lisää rekisterissä Rj olevaan lukuun  jälkimmäisen operan-
       din arvon.
SUB    (subtract) vähennä rekisterissä Rj olevasta luvusta  jälkimmäisen
       operandin arvon.
MUL    (multiply) kerro rekisterissä Rj oleva luku  jälkimmäisen operan-
       din arvolla.
DIV    (divide) jaa rekisterissä Rj oleva luku jälkimmäisen operandin
       arvolla. Jakolaskussa vain kokonaisosalla on merkitystä.
MOD    (modulo) jaa rekisterissä Rj oleva luku  jälkimmäisen operandin
       arvolla. Jakolaskussa vain jakojäännösosalla on merkitystä.

AND    (boolean AND) looginen JA-operaatio Rj:n ja jälkimmäisen
       operandin arvon välillä.
OR     (boolean OR) looginen TAI-operaatio Rj:n ja jälkimmäisen
       operandin arvon välillä.
XOR    (boolean XOR) looginen poissulkeva TAI-operaatio Rj:n ja
       jälkimmäisen operandin arvon välillä.
SHL    (shift left) siirrä rekisterin Rj bittejä vasemmalle toisen
       operandin ilmoittama määrä. Täytä oikeaa päätä 0-biteillä.
SHR    (shift right) kuten SHL, mutta siirrä oikealle.
SHRA   (arithmetic shift right) kuten SHR, mutta säilyttäen etumerkin
       (täytä vasenta päätä etumerkkibitillä).

COMP   (compare) vertaa ensimmäisen operandin arvoa toisen operandin
       arvoon ja aseta vertailun tulos tilarekisterin bitteihin SR
       L=pienempi, E=yhtäsuuri, G=suurempi.

Haarautumiskäskyt:

JUMP   (unconditional jump) ehdoton hyppy toisen operandin ilmaisemaan
       kohdeosoitteeseen.

JNEG   (jump if negative) jos Rj < 0, niin hyppää jälkimmäisenä operan-
       dina olevaan osoitteeseen, muuten jatka seuraavasta käskystä.
JZER   (jump if zero)         jos Rj = 0
JPOS   (jump if positive)     jos Rj > 0
JNNEG  (jump if not negative) jos Rj >= 0
JNZER  (jump if not zero)     jos Rj <> 0
JNPOS  (jump if not positive) jos Rj <= 0

JLES   (jump if less) jos tilarekisterin SR bitti L asetettu, niin
       hyppää jälkimmäisenä operandina olevaan osoitteeseen, muuten
       jatka seuraavasta käskystä (käyttö COMP-käskyn yhteydessä).
JEQU   (jump if equal)         jos bitti E asetettu
JGRE   (jump if greater)       jos bitti G asetettu
JNLES  (jump if not less)      jos bitti E tai G asetettu
JNEQU  (jump if not equal)     jos bitti L tai G asetettu
JNGRE  (jump if not greater)   jos bitti L tai E asetettu

Pinokäskyt:

Käskyn ensimmäinen operandi rekisteri Rj osoittaa pinon huipulle pinon
päällimmäiseen alkioon. Pino-osoittimena käytetään tavallisesti rekiste-
riä SP (eli R6).

PUSH   Kasvata pino-osoittimen Rj arvoa yhdellä ja vie jälkimmäinen
       operandi pinon päällimmäiseksi alkioksi.

POP    Poista pinosta päällimmäinen alkio ja vie se jälkimmäisenä
       operandina kerrottuun rekisteriin (HUOM: aina rekisteri).
       Vähennä pino-osoittimen Rj arvoa yhdellä.

PUSHR  Vie pinoon rekisterit R0, R1, R2, R3, R4, R5 ja R6 (SP) tässä
       järjestyksessä. Ennen kunkin rekisterin vientiä kasvata pino-
       osoittimen Rj arvoa yhdellä. 

POPR   Nouda pinosta arvot rekistereihin R6 (SP), R5, R4, R3, R2, R1 ja 
       R0 tässä järjestyksessä. Jokaisella noudolla hae ensin arvo
       pino-osoittimen Rj osoittamasta kohdasta kyseiseen rekisteriin 
       ja sen jälkeen vähennä pino-osoittimen Rj arvoa yhdellä.


Aliohjelmakäskyt:

CALL   (call procedure) aliohjelmakutsu, eli kontrollin siirto toisen
       operandin ilmoittamaan osoitteeseen. Tallettaa paluuosoitteen
       pinoon, jonka huipulle osoittaa Rj.
EXIT   palaa aliohjelmasta kutsua seuraavaan käskyyn. Paluuosoite löytyy
       pinosta, jonka huipulle osoittaa Rj. Jälkimmäisenä operandina
       pinossa välitettyjen parametrien lukumäärä.

Systeemikutsut:

SVC    (supervisor call) käyttöjärjestelmän palvelurutiinin kutsu.
       (systeemikutsu). Ensimmäisenä operandi pinon huippu Rj ja toisena
       operandina palvelun numero. Palvelurutiinikutsut ovat erikoisia
       kutsuja ennalta määrättyihin aliohjelmiin. Rutiinien koodi on
       näkymättömissä, koodialueen "ulkopuolella".

       Palvelunumeroita:

       HALT : Lopettaa ohjelman suorituksen.
       TIME : Antaa kellonajan. Pinossa välitettävä osoitteet, jonne
              halutaan tunnit, minuutit, sekunnit (HUOM: järjestys!).
       DATE : Antaa päiväyksen. Pinossa välitettävä osoitteet, jonne
              halutaan vuosi, kuukausi ja päivä. (HUOM: järjestys!).
       READ : Lukee kokonaisluvun. Pinossa välitettävä osoite, jonne
              luku halutaan luettavan.
       WRITE: Kirjoittaa kokonaisluvun. Pinossa välitettävä tulostettava
              arvo.

Muita:

NOP    (no operation) ei toimintaa

======================================================================
                    TTK-91-konekielen käskykoodit
======================================================================

   Käsky     Binääri   Desimaali Heksadesimaali

   NOP       0000 0000     0        00            

   STORE     0000 0001     1        01
   LOAD      0000 0010     2        02
   IN        0000 0011     3        03
   OUT       0000 0100     4        04

   ADD       0001 0001    17        11
   SUB       0001 0010    18        12
   MUL       0001 0011    19        13
   DIV       0001 0100    20        14
   MOD       0001 0101    21        15

   AND       0001 0110    22        16
   OR        0001 0111    23        17
   XOR       0001 1000    24        18
   SHL       0001 1001    25        19
   SHR       0001 1010    26        1A
   SHRA      0001 1011    27        1B

   COMP      0001 1111    31        1F

   JUMP      0010 0000    32        20
   JNEG      0010 0001    33        21
   JZER      0010 0010    34        22
   JPOS      0010 0011    35        23
   JNNEG     0010 0100    36        24
   JNZER     0010 0101    37        25
   JNPOS     0010 0110    38        26

   JLES      0010 0111    39        27
   JEQU      0010 1000    40        28
   JGRE      0010 1001    41        29
   JNLES     0010 1010    42        2A
   JNEQU     0010 1011    43        2B
   JNGRE     0010 1100    44        2C

   CALL      0011 0001    49        31
   EXIT      0011 0010    50        32
   PUSH      0011 0011    51        33
   POP       0011 0100    52        34
   PUSHR     0011 0101    53        35
   POPR      0011 0110    54        36

   SVC       0111 0000   112        70

======================================================================
                 TTK-91-koneen ennalta määrätyt symbolit
======================================================================

Näitä symboleja voi käyttää TTK-91-ohjelmassa niitä erikseen 
määrittelemättä.

Symboli         Arvo
--------------------
CRT             0
KBD             1
STDIN           6
STDOUT          7
HALT            11
READ            12
WRITE           13
TIME            14
DATE            15



======================================================================
                 Kääntäjän ohjauskäskyt (valekäskyt)
======================================================================

Kääntäjän ohjauskäskyt antavat ohjeita symbolisen konekielen kääntäjäl-
le. Ne EIVÄT ole varsinaisia symbolisen konekielen käskyjä.

tunnus EQU arvo

Samaistuskäsky EQU määrittelee symboliselle tunnukselle kokonaislukuar-
von. Tunnusta voi käyttää  käskyn ADDR -kentässä, jolloin se käsitellään
kuten vastaavaan paikkaan kirjoitettu "arvo".

tunnus DC arvo

Muistinvarauskäsky DC (data constant) varaa yhden muistisanan vakiota
varten, samaistaa varatun muistipaikan osoitteen ja symbolisen osoitteen
"tunnus" sekä asettaa varatun muistipaikan sisällöksi luvun "arvo".
Tunnusta voi käyttää käskyn ADDR-kentässä kuten muistiosoitetta.

tunnus DS koko

Muistinvarauskäsky DS (data segment) varaa muistialueen, jonka koko on
"koko" (sanoina) ja samaistaa varatun muistialueen alkuosoitteen ja
symbolisen osoitteen "tunnus". Käytetään globaalien muuttujien tilanva-
raukseen. Tunnusta voi käyttää käskyn ADDR -kentässä kuten muistiosoi-
tetta.

asetus DEF merkkijono

DEF muuttaa TTK-91-koneen tiedostojärjestelmän simulointiasetuksia. 
Merkkijonon 'merkkijono' tulee olla absoluuttinen tiedostopolku. 
Esimerkkejä: 
  STDIN DEF /home/myuser/ttk91/stdin
  STDOUT DEF C:\mydir\stdout

Muutettavat asetukset:
  STDIN   Stdin-datan lähdetiedosto.
  STDOUT  Stdout-datan kohdetiedosto.
  HOME    Käyttäjän kotihakemisto. Titokoneessa tätä ei käytetä, vaan
          kotihakemisto kysytään Javan virtuaalikoneen kautta itse
          käyttöjärjestelmältä.

Oletustiedostot kahdelle ensimmäiselle ovat stdin ja stdout käyttäjän
kotihakemistossa. 
</pre>

<h2><a name="laajentaminen">4. Järjestelmän hienosäätö ja laajentaminen</a></h2>

  <h3>4.1 Asetustiedostot</h3>

  <h3><a name="kielenlisays">4.2 Uuden kielen tukeminen</a></h3>
<p> Uuden kielen lisääminen Titokoneeseen tapahtuu antamalla käännösvastineet oletuskielenä toimivan kielen sanoille. Oletuskielenä
on englanti. Lisättävää kieltä varten kirjoitetaan ohjeiden mukainen Java-tiedosto, joka käännetään ja avataan Titokoneen käyttöliittymän kautta. Uuden kielitiedoston kirjoittaminen käy helpoiten ottamalla mallia olemassaolevasta kielitiedostosta. Avaa koneeltasi ensin tekstieditori, johon haet Titokone.jar -paketin mukana tulleen tiedoston Translations_fi.java -tiedoston hakemistosta fi/hu/cs/titokone/resources. Tekstieditoriin aukeaa Javan ResourceBundle-kalustoa
hyväksikäyttävä luokka, joka muodostuu 2-ulotteisesta Object-taulukosta ja sen palauttavasta metodista. Taulukon alkiot näyttävät seuraavilta:</p>
<pre>
   { "Fetch second operand from memory slot {0}.", "Nouda jälkimmäinen operandi muistipaikasta {0}."},
   { "Indirect memory addressing mode.", "Epäsuora muistiosoitus."},
   { "1: Fetch indexing value from memory slot {0}.", "1: Nouda indeksointiarvo muistipaikasta {0}."}, 
</pre>
<p> 
Jokainen rivi koostuu aaltosulkujen välissä olevasta oletuskielen avainarvosta ja sen käännösvastineesta. 
Uloimpien aaltosulkujen sisällä on kaksi lainausmerkeillä rajattua tekstikenttää, jotka on erotettu pilkulla toisistaan.
Ensimmäisten lainausmerkkien sisällä on oletuskielinen käännösavain. Toisten lainausmerkkien sisällä on käännösvastine.
Oma käännösvastine luodaan korvaamalla suomenkielinen teksti. Käännöksiä helpottamaan Translations_fi -tiedostossa
on kommenteilla kerrottu mihin osaan käyttöliittymää kyseiset käännökset viittaavat. Ylläolevan simerkin käännöksissä esiintyy
erikoismerkkijono, '{0}'. Kyseisen merkkijonon tilalle sijoitetaan muuttuja, joka liittyy käyttöliittymälle välitettävään viestiin.
Esimerkin ensimmäisen rivin {0} sisältää muistipaikan numeron; tämä on pääteltävissä itse lauseesta. On mahdollista luoda uusi käännösvastine, jonka muuttuja
ei olekaan rivin lopussa, esimerkiksi:
<pre>
{ "Fetch second operand from memory slot {0}.", "Nouda jälkimmäinen operandi muistipaikasta {0}."},
-->
{ "Fetch second operand from memory slot {0}.", "Muistipaikasta {0} noudetaan jälkimmäinen operandi."},
</pre>
<p> Uusi kielitiedosto luodaan seuraavasti: </p>
<ol>
<li> Avaa Translations_fi.java.</li>
<li> Anna käännösvastineet suomenkielisten tekstien kohdalle. </li>
<li> Sijoita muuttujat {0}...{n} mielekkäille paikoille lauseessa </li>
<li> Poista tiedostosta rivi 4: 'package fi.hu.cs.titokone.resources;'.</li>
<li> Tallenna tiedosto haluamaasi paikkaan. </li>
<li> Käännä tiedosto esimerkiksi javac-komennolla</li>
<li> Käynnistä titokone </li>
<li><a href=#kielenvaihto>Vaihda kielitiedosto</a> </li>
</ol>
<br>

<h2><a name="pulmanpoisto">5. Virhetilanteita</a></h2>

  <ul>

  <li> Oudot taustasäievirheet: yleisohje, jos leviää, kokeile uudelleen. 
       Yleensä johtuvat kuun väärästä asennosta ja poistuvat toisella
       yrityksellä. Pahoittelumme. </li>

  <li>Ohjelma ilmoittaa vain, että mikäli
  tulevaisuudessa näillä asetuksilla joku TTK-91-sovellus yrittää
  lukea STDIN-laitteelta, luku epäonnistuu ellei jotain tehdä
  asialle. "Joku syy" -osuus kertoo, mikä järjestelmän antama
  virheilmoitus oli kun tiedostoa luettiin. Jos sovelluksesi tarvitsee
  STDIN-laitetta, korjaa tiedoston tilanne ja lataa sovellus
  uudelleen. Ks. myös <a href="#lataaminen">2.5, TTK-91-ohjelman
  lataaminen</a>.</li>
    
  <li>On tylsää.</li>
  <li>Syö leipää ni ei o tylsää. --Jukka Tilsa</li>



</body>
</html>
